<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tensor的基本操作：索引、切片和广播 | 工具箱的深度学习记事簿</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/statics/logo.svg">
    <meta name="description" content="这里包含了我从入门到依然在入门的过程中接触到的大部分知识。翻翻目录，也许能找到有用的">
    <meta name="keywords" content="Akasaki,Deep learning,Machine learning,工具箱,工具箱的深度学习记事簿,Akasaki的深度学习记事簿">
    
    <link rel="preload" href="/assets/css/0.styles.90685b8c.css" as="style"><link rel="preload" href="/assets/js/app.a1fbffca.js" as="script"><link rel="preload" href="/assets/js/2.8096074b.js" as="script"><link rel="preload" href="/assets/js/39.7f5e2f13.js" as="script"><link rel="prefetch" href="/assets/js/10.a686cd20.js"><link rel="prefetch" href="/assets/js/11.19e9baf6.js"><link rel="prefetch" href="/assets/js/12.9212f282.js"><link rel="prefetch" href="/assets/js/13.7d0f7067.js"><link rel="prefetch" href="/assets/js/14.4a36e2d7.js"><link rel="prefetch" href="/assets/js/15.e1769a04.js"><link rel="prefetch" href="/assets/js/16.fd1042ef.js"><link rel="prefetch" href="/assets/js/17.f934604d.js"><link rel="prefetch" href="/assets/js/18.bc63a823.js"><link rel="prefetch" href="/assets/js/19.5adad4c4.js"><link rel="prefetch" href="/assets/js/20.0e6892e6.js"><link rel="prefetch" href="/assets/js/21.884c24bc.js"><link rel="prefetch" href="/assets/js/22.3d7bcd74.js"><link rel="prefetch" href="/assets/js/23.b63f63e0.js"><link rel="prefetch" href="/assets/js/24.aec13a9a.js"><link rel="prefetch" href="/assets/js/25.c5426924.js"><link rel="prefetch" href="/assets/js/26.3eb3ba10.js"><link rel="prefetch" href="/assets/js/27.024a3e04.js"><link rel="prefetch" href="/assets/js/28.2772c9bc.js"><link rel="prefetch" href="/assets/js/29.f8ff87be.js"><link rel="prefetch" href="/assets/js/3.98a4c7dc.js"><link rel="prefetch" href="/assets/js/30.50fb28dc.js"><link rel="prefetch" href="/assets/js/31.e24576ff.js"><link rel="prefetch" href="/assets/js/32.9b004a72.js"><link rel="prefetch" href="/assets/js/33.516e30b3.js"><link rel="prefetch" href="/assets/js/34.fce7f963.js"><link rel="prefetch" href="/assets/js/35.dbf61b38.js"><link rel="prefetch" href="/assets/js/36.f3d6b628.js"><link rel="prefetch" href="/assets/js/37.90bb0caf.js"><link rel="prefetch" href="/assets/js/38.6eac4913.js"><link rel="prefetch" href="/assets/js/4.0620af2a.js"><link rel="prefetch" href="/assets/js/40.716fd348.js"><link rel="prefetch" href="/assets/js/41.bb24042a.js"><link rel="prefetch" href="/assets/js/42.c9635060.js"><link rel="prefetch" href="/assets/js/43.b27f3f72.js"><link rel="prefetch" href="/assets/js/44.621812ce.js"><link rel="prefetch" href="/assets/js/45.17e3feb2.js"><link rel="prefetch" href="/assets/js/46.e72b5883.js"><link rel="prefetch" href="/assets/js/47.92f030b3.js"><link rel="prefetch" href="/assets/js/48.eb61d01c.js"><link rel="prefetch" href="/assets/js/49.40e72ee7.js"><link rel="prefetch" href="/assets/js/5.48054ee2.js"><link rel="prefetch" href="/assets/js/50.285dbe55.js"><link rel="prefetch" href="/assets/js/51.bd3fd655.js"><link rel="prefetch" href="/assets/js/52.6e2aafec.js"><link rel="prefetch" href="/assets/js/53.6fdc61bc.js"><link rel="prefetch" href="/assets/js/54.199b7b93.js"><link rel="prefetch" href="/assets/js/55.0eaa332d.js"><link rel="prefetch" href="/assets/js/56.d922b396.js"><link rel="prefetch" href="/assets/js/57.b8b028de.js"><link rel="prefetch" href="/assets/js/6.172b3315.js"><link rel="prefetch" href="/assets/js/7.c978e4d5.js"><link rel="prefetch" href="/assets/js/8.13e9f00e.js"><link rel="prefetch" href="/assets/js/9.b094690e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.90685b8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">工具箱的深度学习记事簿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/VisualDust/ml.akasaki.space" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/VisualDust/ml.akasaki.space" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第零章：在开始之前</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一章上：HelloWorld</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一章下：深度学习基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第二章上：卷积神经网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第二章下：经典卷积神经网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三章上：谈一些计算机视觉方向</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三章下：一些计算机视觉任务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>附录：永远是你的好朋友</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第-1章：TensorFlow编程策略</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch-1/[1]operation-on-tensors-1.html" class="active sidebar-link">Tensor的基本操作：索引、切片和广播</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ch-1/[1]operation-on-tensors-1.html#list" class="sidebar-link">List</a></li><li class="sidebar-sub-header"><a href="/ch-1/[1]operation-on-tensors-1.html#tensor" class="sidebar-link">Tensor</a></li><li class="sidebar-sub-header"><a href="/ch-1/[1]operation-on-tensors-1.html#selective-index" class="sidebar-link">Selective index</a></li><li class="sidebar-sub-header"><a href="/ch-1/[1]operation-on-tensors-1.html#维度变换" class="sidebar-link">维度变换</a></li><li class="sidebar-sub-header"><a href="/ch-1/[1]operation-on-tensors-1.html#tensorflow-broadcast" class="sidebar-link">tensorflow.broadcast</a></li><li class="sidebar-sub-header"><a href="/ch-1/[1]operation-on-tensors-1.html#summary-of-dim-expanding" class="sidebar-link">Summary of dim expanding</a></li></ul></li><li><a href="/ch-1/[2]operation-on-tensors-2.html" class="sidebar-link">Tensor的基本操作：合并、分割以及统计</a></li><li><a href="/ch-1/[3]operator-for-tensors.html" class="sidebar-link">张量的基本数学运算</a></li><li><a href="/ch-1/[4]tensorflow-strategy.html" class="sidebar-link">TensorFlow编程策略</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第-2章：数字信号处理（DSP）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>魔法部日志（又名论文阅读日志）</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tensor的基本操作-索引、切片和广播"><a href="#tensor的基本操作-索引、切片和广播" class="header-anchor">#</a> Tensor的基本操作：索引、切片和广播</h1> <p>索引和切片能够很方便的帮你拿到你想要的部分数据。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># importing</span>
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'3'</span> 
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a@a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>tf.Tensor(
[[1 0 1 0]
 [0 1 0 1]
 [0 1 0 0]
 [1 0 1 0]], shape=(4, 4), dtype=int32)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="list"><a href="#list" class="header-anchor">#</a> List</h2> <p>List是python的builtin，是一种非常灵活的数据载体， 可以包含任何类型的数据</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
d <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
e <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;a=&quot;</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span><span class="token string">&quot;b=&quot;</span><span class="token punctuation">,</span>b<span class="token punctuation">,</span><span class="token string">&quot;c=&quot;</span><span class="token punctuation">,</span>c<span class="token punctuation">,</span><span class="token string">&quot;d=&quot;</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span><span class="token string">&quot;e=&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上述代码产生以下输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a= ['a', 'b', 'c'] b= [1, 2, 3] c= [1, 2, 'c'] d= [1, 'b', [3]] e= [1, [1, 2, 3], [[1, 2, 'c'], '4']]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="tensor"><a href="#tensor" class="header-anchor">#</a> Tensor</h2> <p>Tensor意味着张量，是一种自由的多维度数据载体，也是tensorflow使用的数据载体。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>tensor_0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 假设这是一个含有四张28x28像素彩色图片的数据集</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;数据集的shape: &quot;</span><span class="token punctuation">,</span>tensor_0<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> 
<span class="token comment"># 省略号...代表任意长度的冒号，只要能在逻辑上推断的都可以使用省略号</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第一张照片的shape: &quot;</span><span class="token punctuation">,</span>tensor_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;和上一行等效，时第一张图片的shape: &quot;</span><span class="token punctuation">,</span>tensor_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 省略号也可以用来省略前面的冒号</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;所有照片的所有像素的Red通道的shape: &quot;</span><span class="token punctuation">,</span>tensor_0<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;和上一行等效，时所有像素的Red通道的shape: &quot;</span><span class="token punctuation">,</span>tensor_0<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>数据集的shape:  (4, 28, 28, 3)
第一张照片的shape:  (28, 28, 3)
和上一行等效，时第一张图片的shape:  (28, 28, 3)
所有照片的所有像素的Red通道的shape:  (4, 28, 28)
和上一行等效，时所有像素的Red通道的shape:  (4, 28, 28)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="selective-index"><a href="#selective-index" class="header-anchor">#</a> Selective index</h2> <p>使用冒号等能获得连续的一段数据，而SelectiveIndex能获取可以定义具体的采样方式。</p> <h3 id="tensorflow-gather"><a href="#tensorflow-gather" class="header-anchor">#</a> tensorflow.gather</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># indices意味指标。在使用gather时需要一个选择的指标作为参数。</span>
<span class="token comment"># 举个例子，有4个班级，每个班级5名学生，每个学生有5门课程。数据集表示所有学生的所有课程的成绩。</span>
course_score <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;二班和三班成绩的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>indices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment"># 在维度0中选择下标2和3。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;通过简单索引获得相同效果: &quot;</span><span class="token punctuation">,</span>course_score<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment"># 与上述语句等效的传统的选择方式</span>
<span class="token comment"># 使用gather能让你在选择顺序上下手脚</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;三班和二班的成绩的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>indices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment"># 改变了选择的顺序</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;抽取每个班第 2 3 4 个学生的成绩&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>indices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment"># gather可以取任意维度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;抽取所有学生的第 2 3 门课程的成绩&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>indices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment"># 还是演示改变选择的维度</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以上代码的输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>二班和三班成绩的shape:  (2, 35, 8)
通过简单索引获得相同效果:  (2, 35, 8)
三班和二班的成绩的shape:  (2, 35, 8)
抽取每个班第 2 3 4 个学生的成绩 (4, 3, 8)
抽取所有学生的第 2 3 门课程的成绩 (4, 35, 2)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="tensorflow-gather-nd"><a href="#tensorflow-gather-nd" class="header-anchor">#</a> tensorflow.gather_nd</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># gater_nd 能够使用更复杂的筛选条件</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;取第1个班级的第2个同学的第3门课的成绩&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>gather_nd<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;分别取第1和第2个班级的第3个和第4个学生的成绩&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>gather_nd<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>取第1个班级的第2个同学的第3门课的成绩 ()
分别取第1和第2个班级的第3个和第4个学生的成绩 (2, 8)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="tensorflow-boolean-mask"><a href="#tensorflow-boolean-mask" class="header-anchor">#</a> tensorflow.boolean_mask</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># boolean_mask 能通过一个布尔序列进行筛选。boolean_mask可以在某种程度上实现reshape</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;对第一个维度进行筛选，只选择前两个&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>boolean_mask<span class="token punctuation">(</span>tensor_0<span class="token punctuation">,</span>mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;筛选出每张图片所有像素的R和G通道&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>boolean_mask<span class="token punctuation">(</span>tensor_0<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

a<span class="token operator">=</span>tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 在这里我们选用一个两行三列的mask，涉及到原样本a的前两个维度的筛选</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;筛选出[0,0]&lt;4&gt;[1,1]&lt;4&gt;[1,2]&lt;4&gt;&quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>boolean_mask<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 不懂，等着再看看</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="维度变换"><a href="#维度变换" class="header-anchor">#</a> 维度变换</h2> <p>维度变换是学习人工神经网络需要理解的基本概念之一。
对于一个多维的数据，可以有不同的理解方式。例如，我们有一份[4,28,28,3]的数据集，代表一个含有四张28x28像素的彩色图片的数据集。接下来我们提供两种理解方式：
这是四张图片。
这是4x28行像素，每行有28个。
其实理论上理解方式可以有很多种。但是无论采用何种方式理解，数据的content本身是不会变化的。我们称不同的理解方式为不同的View。</p> <h3 id="tensorflow-reshape"><a href="#tensorflow-reshape" class="header-anchor">#</a> tensorflow.reshape</h3> <p>Reshape就是一个用不同的View理解Tensor的过程。Reshape是全连接层常用操作之一。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>tensor_1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原来的tensor_1: &quot;</span><span class="token punctuation">,</span>tensor_1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># tensorflow.reshape需要传入一个原始数据和一个你希望得到的view，就能在允许的范围内进行reshape</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在reshape为view[4, 28*28, 3]之后: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tensor_1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">784</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 上述代码中的view可以等价写为以下代码中的形式</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在reshape为view[4,-1,3]之后: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tensor_1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 注意，一个view中只能写下一个-1，reshape方法会根据你写下的-1自动推算维度。如果同时出现多个-1，就会导致无法推算的问题</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在reshape为view[4,28*28*3]之后: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tensor_1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 同样，上述代码可以使用-1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在reshape为view[4,-1]之后: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tensor_1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 这种类型情况下的reshape通常是可逆的。你可以把它reshape回来</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;试图reshape回veiw[4,28,28,3]: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tensor_1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>以上代码的输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>原来的tensor_1:  (4, 28, 28, 3)
在reshape为view[4, 28*28, 3]之后:  (4, 784, 3)
在reshape为view[4,-1,3]之后:  (4, 784, 3)
在reshape为view[4,28*28*3]之后:  (4, 2352)
在reshape为view[4,-1]之后:  (4, 2352)
试图reshape回veiw[4,28,28,3]:  (4, 28, 28, 3)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="tensorflow-transpose"><a href="#tensorflow-transpose" class="header-anchor">#</a> tensorflow.transpose</h3> <p><code>tensorflow.reshape</code>可以帮助你获得不同view下的content，但是并不能改变content。而<code>转置(transpose)</code>可以帮助你更换content中各个维度的顺序。 转置操作可以是线性代数意义上的(默认情况)，也可以根据你传入的参数按需改变content。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>matrix <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原矩阵形状: &quot;</span><span class="token punctuation">,</span>matrix<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 不带参数的默认的转置是线性代数意义上的矩阵转置</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;转置后的矩阵形状: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>matrix<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 可以传入参数规定矩阵中各个维度出现的顺序</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;将维度顺序换为0,1,3,2后的形状: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>matrix<span class="token punctuation">,</span>perm<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>以上代码输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>原矩阵形状:  (4, 3, 2, 1)
转置后的矩阵形状:  (1, 2, 3, 4)
将维度顺序换为0,1,3,2后的形状:  (4, 3, 1, 2)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="tensorflow-expand-dims"><a href="#tensorflow-expand-dims" class="header-anchor">#</a> tensorflow.expand_dims</h3> <p>还是用学生成绩的例子，现在有分别来自两个学校的四个班级，每个班级35名学生，每名学生有8门课有成绩。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># students' score of the two schools  </span>
course_score <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原来的成绩的shape: &quot;</span><span class="token punctuation">,</span>course_score<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 追加维度时axis给出0，则在首位追加一个维度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在下标0前追加一个维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 给出的axis等于现存维度总数，会在最后追加一个维度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在下标3处追加一个维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 给出的axis是任意小于维度总数的整数x，会在现有的x维度之前追加一个维度。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在下标2之前追加一个维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 给出的axis是负数-x，则会从后往前index到x并追加一个维度  </span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;给出axis=-1追加一个维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>course_score<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;给出axis=-4追加一个维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>course_socre<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="tensorflow-queeze"><a href="#tensorflow-queeze" class="header-anchor">#</a> tensorflow.queeze</h3> <p><code>squeeze</code>本身是压榨、挤压的意思。其功能如起义，能够帮你将为1的维度挤压掉。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># only squeeze for shape=1 dim</span>
shape_0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原始的shape_0的shape: &quot;</span><span class="token punctuation">,</span>shape_0<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;挤压掉为1的维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>shape_0<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;挤压掉下标为0的维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>shape_0<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;挤压掉下标为2的维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>shape_0<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;挤压掉下标为-2的维度后的shape: &quot;</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>shape_0<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="tensorflow-broadcast"><a href="#tensorflow-broadcast" class="header-anchor">#</a> tensorflow.broadcast</h2> <p>以班级和学生成绩为例，现在有四个班级，每个班级有35名学生，每个学生有八门课的成绩。现规定[4,35,8]为全体学生的成绩。例如，第二门科目是物理，而本次物理考试较难，老师打算为所有学生的物理成绩加上5分。也就是，对于每个学生的成绩<a href="%E4%B8%80%E4%B8%AA%E5%85%AB%E7%BB%B4%E6%95%B0%E6%8D%AE">4,x</a>加上[0,5,0,0,0,0,0,0]。我们可以这样操作：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>origin <span class="token operator">=</span> tensorflow<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
another <span class="token operator">=</span> tensorflow<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> tensorflow<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>another<span class="token punctuation">,</span> origin<span class="token punctuation">)</span>
<span class="token comment"># 这样another就会被扩展到origin的维度</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>[4, 16, 16, 32]习惯上将前面的维度称为大维度，后面的维度称为小维度。Broadcasting会先将小维度对齐，然后对于之前的每一个相对较大的维度，如果缺失，就补1。在这之后，这些为1的维度会被扩展到与目标相同的size。例如，将[32]进行broadcasting，目标是[4,16,16,32]:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>(1) [32]-&gt;[1,1,1,32]
(2) [1,1,1,32]-&gt;[4,16,16,32]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>原API描述为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>(1) Insert 1 dim ahead if needed
(2) Expand dims with size 1 to the same size
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以下是一个更为现实的例子
<img src="https://camo.githubusercontent.com/bee1dc67dd6f7870c9833871ee986832002be43c/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303230313030393130343332363637332e706e673f782d6f73732d70726f636573733d696d6167652f77617465726d61726b2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c315a7063335668624552316333513d2c73697a655f31362c636f6c6f725f4646464646462c745f3730237069635f63656e746572" alt="example"></p> <p>需要注意的是比并不是所有的情况都能broadcasting。例如[4]与[1,3]，4并不能通过broadcasting变为3。</p> <ul><li><p>关于优化</p> <p>broadcasting进行了特别的优化。在进行broadcasting的过程中不会产生大量的数据复制。这会帮你减少复制带来的内存占用。</p> <blockquote><p>请注意，你并不额能随便Broadcasting。</p></blockquote></li></ul> <p>例如，[2,32,32,14]并不能通过Broadingcast变为[4,32,32,14]。允许broadcasting的条件要求被扩展的维度缺失或为1.</p> <h2 id="summary-of-dim-expanding"><a href="#summary-of-dim-expanding" class="header-anchor">#</a> Summary of dim expanding</h2> <p>也就是说，我们现在有了三种扩展维度的方式。以[3,4]扩展到[2,3,4]为例：
第一种是broadcasting:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>origin <span class="token operator">=</span> tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> tf<span class="token punctuation">.</span>broadcast_to<span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tf.Tensor(
[[[1. 1. 1. 1.]
  [1. 1. 1. 1.]
  [1. 1. 1. 1.]]

 [[1. 1. 1. 1.]
  [1. 1. 1. 1.]
  [1. 1. 1. 1.]]], shape=(2, 3, 4), dtype=float32)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>第二种是expand_dims:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>origin <span class="token operator">=</span> tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>origin<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> tf<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tf.Tensor(
[[[1. 1. 1. 1.]
  [1. 1. 1. 1.]
  [1. 1. 1. 1.]]

 [[1. 1. 1. 1.]
  [1. 1. 1. 1.]
  [1. 1. 1. 1.]]], shape=(2, 3, 4), dtype=float32)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>可以看到，两种方法得到的结果是一样的。不过区别是broadcasting存在优化，而expand和tile并没有优化。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">5/5/2021, 8:29:12 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/appendix/[6]types-of-top-paper-and-meeting.html" class="prev">
        一些顶尖的会议和期刊特色
      </a></span> <span class="next"><a href="/ch-1/[2]operation-on-tensors-2.html">
        Tensor的基本操作：合并、分割以及统计
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a1fbffca.js" defer></script><script src="/assets/js/2.8096074b.js" defer></script><script src="/assets/js/39.7f5e2f13.js" defer></script>
  </body>
</html>
